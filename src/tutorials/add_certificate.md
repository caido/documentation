---
description: "Learn how to add Caido's CA certificate to Android system store for HTTPS traffic interception on rooted devices."
---

# Adding Caido's CA Certificate to the System-Store

In this tutorial, we will cover the process of adding Caido's CA certificate to the system-store of an Android device.

::: danger WARNING
Caido is not liable for any malfunctions, failures, damages, loss/theft of data, or other technical issues that may occur with your device as a result of following this tutorial. Proceed at your own risk.
:::

::: warning NOTE
This tutorial is a continuation of [Android Setup and Configuration](/tutorials/android_configuration.md). Ensure your environment and device are prepared before continuing.
:::

::: info

- ****This process requires a rooted device.****
- Be aware that the exact names and locations of setting options may vary between devices.
- Ensure to pay attention to any prompts on the device itself while proceeding through these steps.
- For convenience, add all installed tools to your system's `PATH` envrionment variable to make them globally accessible. Ensure to restart your terminal afterwards so the changes take effect.
- For physical devices, make sure the device is connected to the computer running Caido via USB and that both the device and the computer are on the same Wi-Fi network.
:::

## Android Studio

::: warning NOTE
This tutorial will demonstrate adding a system certificate using a virtual device.
:::

**Android Studio** is the official IDE for developing Android applications. It features the **Android Emulator** that can create a variety of Android Virtual Devices at specified API levels.

[Download and install Android Studio for your operating system.](https://developer.android.com/studio)

The installation also includes the **Android SDK** which provides multiple packages of command-line tools, including:

- `adb`: The **Android Debug Bridge**, included in the Platform-Tools package, allows you to interface with the Android device using your computer's terminal.
- `emulator`: Included in **Emulator** package, this terminal command gives you control over an AVD.

You can view the location of the available SDK developer tools by selecting `SDK Manager` from the `More Actions` drop-down menu of the `Projects` interface.

<img alt="List of connected Android devices." src="/_images/sdk_manager.png" center no-shadow/>

In the window that appears, the `Android SDK Location` will contain the full file path to the packages.

<img alt="List of connected Android devices." src="/_images/android_studio_sdk_tools.png" center no-shadow/>

::: warning NOTE
System images that include Google Play in their build are signed with a release key and don't allow root access. In order to capture HTTPS traffic generated by an application with Caido, avoid selecting any Google Play builds when [creating an AVD](https://developer.android.com/studio/run/managing-avds?utm_source=android-studio).

Additionally, if you want to follow along with these tutorials, avoid selecting any ATD builds as they do not include a user interface for the device.

Instead, use images listed as:

- Google APIs
- Android Open Source Project (AOSP)
- Default Android System Image
- Base versions (_Android x.x.x ()_)
:::

## Renaming Caido's CA Certificate

In order for Caido's CA Certificate to be compatible with the Android system, it will need to meet the expected naming format.

<img alt="List of connected Android devices." src="/_images/cert_name_format.png" center no-shadow/>

1. Generate the legacy hash of Caido's CA certificate's subject field:

```bash
openssl x509 -inform PEM -subject_hash_old -in </path/to/your/ca.crt>
```

2. Rename the Caido CA certificate to the hash with a `.0` extension.

## Adding a System CA Certificate

How to add a certificate to the system-store will depend on the API level of the system image.

::: warning NOTE
This method will only work for Android API level <= 33.
:::

1. List your available AVDs:

```bash
emulator -list-avds
```

2. Launch the desired AVD with write permissions (_if your virtual device is currently running, terminate it first_):

```bash
emulator -avd <avd> -writable-system
```

3. In a new terminal, restart the `adbd` process on the emulator to gain root privileges:

```bash
adb root
```

<img alt="ADB root." src="/_images/adb_root.png" center no-shadow/>

4. Disable secure boot verification:

```bash
adb shell avbctl disable-verification
```

<img alt="ADB disable verification." src="/_images/adb_disable_verification.png" center no-shadow/>

5. Reboot the device:

```bash
adb reboot
```

6. Gain root permissions again:

```bash
adb root
```

7. Remount the partitions as read-write:

```bash
adb remount
```

<img alt="ADB remount." src="/_images/adb_remount.png" center no-shadow/>

8. Push the renamed Caido certificate to the system store:

```bash
adb push </path/to/certificate> /system/etc/security/cacerts
```

<img alt="ADB push." src="/_images/adb_push_cert.png" center no-shadow/>

9. Set the proper permissions:

```bash
adb shell chmod 664 -v /system/etc/security/cacerts/<certificate>
```

<img alt="ADB chmod." src="/_images/adb_chmod.png" center no-shadow/>

10. Reboot the device:

```bash
adb reboot
```

To verify that the certificate was added, list the contents of the `/system/etc/security/cacerts` directory and find the certificate:

```bash
adb shell ls /system/etc/security/cacerts
```

You can also view the certificate addition in the device's interface. Navigate to your device's settings and search for and select `Trusted credentials`. In the `SYSTEM` tab, it will be included in the list.

<img alt="System certificate injected." src="/_images/android_trusted_credentials.png" center no-shadow/>

## What's next?

If the application is still not working properly and traffic is still not being proxied, continue with the [Modifying an Android Application](/tutorials/modifying_apk.md) tutorial.
